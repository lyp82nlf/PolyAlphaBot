# äº¤æ˜“æµç¨‹å®Œæ•´ Walkthrough

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†åšå¸‚å¥—åˆ©ç³»ç»Ÿçš„å®Œæ•´äº¤æ˜“æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
1. å¸‚åœºæ‰«æä¸ç­›é€‰
2. æŒ‚å•ï¼ˆMaker Orderï¼‰
3. è®¢å•ä¿®æ”¹ï¼ˆè¿½å•/æ”¶å‰²ï¼‰
4. åˆ©æ¶¦æ£€æŸ¥ä¸æ’¤å•
5. è®¢å•æˆäº¤ä¸å¯¹å†²
6. åˆå¹¶è·åˆ©
7. æœºä¼šæˆæœ¬ä¼˜åŒ–

### é‡è¦è¯´æ˜

**èµ„é‡‘é…ç½®ç­–ç•¥**ï¼š
- æ¯ç¬”ä¸‹å•ï¼š5 sharesï¼ˆPolymarket API æœ€ä½è¦æ±‚ï¼‰
- å•æ§½é¢„ç•™ï¼š$4.00ï¼ˆSLOT_BUFFER = 0.8ï¼‰
- è®¾è®¡ç†å¿µï¼šä¸æ˜¯æ‰€æœ‰æ§½ä½ä¼šåŒæ—¶æˆäº¤ï¼Œé™ä½é¢„ç•™æé«˜èµ„é‡‘åˆ©ç”¨ç‡
- é£é™©ï¼šå¦‚æœå¤šä¸ªæ§½ä½åŒæ—¶æˆäº¤ï¼Œå¯èƒ½éœ€è¦è¿½åŠ èµ„é‡‘

**è®¡ç®—ç¤ºä¾‹**ï¼š
```
ä½™é¢ $32.37
å¯ç”¨èµ„é‡‘ = $32.37 - $0.05(ä¿ç•™) = $32.32
æœ€å¤§æ§½ä½ = $32.32 / $4.00 = 8 ä¸ªæ§½ä½
```

---

## é˜¶æ®µ0ï¼šç³»ç»Ÿå¯åŠ¨ä¸åˆå§‹åŒ–

### 0.1 å‡¤å‡°åè®®ï¼ˆPhoenix Protocolï¼‰
```
å¯åŠ¨æ—¶æ‰§è¡Œï¼š
1. æ¸…é™¤æ‰€æœ‰æŒ‚å•
2. æ‰«æç°æœ‰æŒä»“
3. è‡ªåŠ¨åˆå¹¶å®Œç¾å¯¹å†²ï¼ˆYes + Noï¼‰
4. æ¥ç®¡å•è¾¹æŒä»“ï¼ˆç©ºé™Workerï¼‰
```

### 0.2 æ§½ä½ç³»ç»Ÿåˆå§‹åŒ–
```python
ä½™é¢: $32.37
å•æ§½æˆæœ¬: $4.00 (5 shares Ã— 0.8 buffer)
æœ€å¤§æ§½ä½: 8 ä¸ª
å½“å‰å ç”¨: 0 ä¸ª
```

**èµ„é‡‘åˆ©ç”¨ç‡ä¼˜åŒ–**ï¼š
- ä¼ ç»Ÿæ–¹æ¡ˆï¼š5 shares Ã— 1.05 = $5.25/æ§½ â†’ 6ä¸ªæ§½ä½
- ä¼˜åŒ–æ–¹æ¡ˆï¼š5 shares Ã— 0.8 = $4.00/æ§½ â†’ 8ä¸ªæ§½ä½
- æå‡ï¼š+33% æ§½ä½æ•°é‡

---

## é˜¶æ®µ1ï¼šå¸‚åœºæ‰«æä¸ç­›é€‰

### 1.1 Scanner Threadï¼ˆåå°çº¿ç¨‹ï¼‰
```
æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ï¼š
1. ä» Gamma API è·å– 300 ä¸ªåŸå§‹å¸‚åœº
2. Strategy Selector è´¨æ£€ï¼š
   - è¯„åˆ†æ’åºï¼ˆå¥–åŠ±ã€å‘¨è½¬ç‡ã€ä»·æ ¼ç„¦ç¼ï¼‰
   - æ‰¹é‡æ´»è·ƒåº¦æ£€æŸ¥ï¼ˆ30åˆ†é’Ÿå†…æœ‰äº¤æ˜“ï¼‰
   - åˆ©æ¶¦é›·è¾¾ï¼ˆSpread > $0.02ï¼‰
3. æ›´æ–°æœºä¼šæ± ï¼ˆOpportunity Poolï¼‰
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“¥ è·å–åˆ° 300 ä¸ªåŸå§‹å¸‚åœº
âœ… è´¨æ£€å®Œæˆ: 19 ä¸ªå¸‚åœºé€šè¿‡ï¼ˆ100%æ´»è·ƒï¼‰
âœ… åˆ©æ¶¦é›·è¾¾å®Œæˆ: 12 ä¸ªå¸‚åœºæœ‰åˆ©æ¶¦ç©ºé—´
```

### 1.2 æœºä¼šæ± ï¼ˆOpportunity Poolï¼‰
```python
# æŒ‰è¯„åˆ†æ’åºçš„å¸‚åœºåˆ—è¡¨
[
    {id: "0x2e43...", score: 55, question: "Will Israel strike..."},
    {id: "0x38c0...", score: 40, question: "Will US strike Iran..."},
    ...
]
```

---

## é˜¶æ®µ2ï¼šæŒ‚å•ï¼ˆMaker Orderï¼‰

### 2.1 ä¸»å¾ªç¯æ¶ˆè´¹æœºä¼š
```python
# main_execution.py - run()
while self.is_running:
    slot_status = self.slot_manager.get_status()
    
    if not slot_status['is_full']:  # æ§½ä½æœªæ»¡
        market, score = self.opportunity_pool.pop_best_market()
        if market:
            self.worker_pool.submit(self._process_market_safe, market)
```

### 2.2 å¸‚åœºåˆ†æ
```python
# _process_market()
1. æ´»è·ƒåº¦æ£€æŸ¥ï¼šç¡®è®¤å¸‚åœºä»ç„¶æ´»è·ƒ
2. è·å–è®¢å•ç°¿ï¼šYes/No åŒè¾¹ä»·æ ¼
3. åšå¸‚åˆ†æï¼š
   - è®¡ç®—æœ€ä½³æŒ‚å•ä»·æ ¼
   - æ£€æŸ¥å¥–åŠ±åŒºï¼ˆReward Zoneï¼‰
   - å­˜è´§åç½®è°ƒæ•´
```

**ç¤ºä¾‹**ï¼š
```
å¸‚åœº: Will Israel strike Lebanon on January 27, 2026?
Yes: bid=$0.590, ask=$0.600
No:  bid=$0.400, ask=$0.410

åˆ†æç»“æœ:
âœ… [MM] No @ $0.410 | edge_taker=0.0000, edge_stress=-0.0051
```

### 2.3 æ§½ä½ç”³è¯·
```python
# slot_manager.request_slot()
if self.slot_manager.request_slot(market_id):
    # æ§½ä½ç”³è¯·æˆåŠŸ
    # æ·»åŠ å½±å­åº“å­˜ï¼ˆé˜²æ­¢é‡å¤ä¸‹å•ï¼‰
    self.slot_manager.add_shadow(market_id, side, 5.0)
```

### 2.4 ä¸‹å•
```python
# order_manager.place_order()
order_id = self.order_manager.place_order(
    token_id="2703042814495764...",
    side="BUY",
    price=0.410,
    size=5  # shares
)
```

**API è¯·æ±‚**ï¼š
```json
POST /order
{
  "tokenID": "2703042814495764...",
  "price": "0.41",
  "size": "5",
  "side": "BUY"
}
```

**å“åº”**ï¼š
```json
{
  "orderID": "0xabec2d491bc93bc5ef...",
  "status": "LIVE"
}
```


### 2.5 æ³¨å†Œäº‹ä»¶ç›‘å¬
```python
# 1. æ³¨å†Œåˆ° MarketWatcherï¼ˆä»·æ ¼å˜åŒ–ç›‘å¬ï¼‰
self.market_watcher.register_observer(task_id, token_id)

# 2. æ³¨å†Œåˆ° HedgeTaskRegistryï¼ˆè®¢å•äº‹ä»¶ç›‘å¬ï¼‰
registry.register_order(order_id, maker_task)
```

**æ—¥å¿—è¾“å‡º**ï¼š
```
ğŸš€ å·²åˆ†å‘ Worker çº¿ç¨‹å¤„ç†: 0x2e43d8... (No)
ğŸŒ‘ [å½±å­åº“å­˜] +5 No â†’ 0x2e43d8... (æ€»:5.0)
 [Observer] æ³¨å†Œ: maker_7a... â†’ 2703042814495764...
ğŸ“‹ [Registry] æ³¨å†Œè®¢å•: 0xabec2d... â†’ maker_7a0427ba
```

---

## é˜¶æ®µ3ï¼šè®¢å•ç›‘æ§ä¸åŠ¨æ€è°ƒæ•´

### 3.1 Worker çº¿ç¨‹è¿›å…¥ç­‰å¾…
```python
# _run_market_worker()
while maker_task.status == 'OPEN':
    # ç­‰å¾…ä¸‰ç§å”¤é†’ä¿¡å·ï¼š
    # A. MarketWatcher ä»·æ ¼å˜åŒ–
    # B. UserListener è®¢å•äº‹ä»¶
    # C. GlobalOrderSyncer å®šæœŸå®¡è®¡
    
    maker_task.event.wait(timeout=30)
```

### 3.2 ä»·æ ¼å˜åŒ–è§¦å‘ï¼ˆè¿½å•/æ”¶å‰²ï¼‰

#### åœºæ™¯Aï¼šä»·æ ¼ä¸Šæ¶¨ï¼ˆè¿½å•ï¼‰
```
åˆå§‹æŒ‚å•: $0.410
å¸‚åœºå˜åŒ–: æœ€ä½³ä¹°ä»· â†’ $0.420

å†³ç­–:
- å½“å‰æ’å: ç¬¬2ä½ï¼ˆè¢«æ’é˜Ÿï¼‰
- åˆ©æ¶¦æ£€æŸ¥: margin = 0.01 (1%) âœ…
- åŠ¨ä½œ: è¿½å•åˆ° $0.420
```

**æ‰§è¡Œ**ï¼š
```python
# ä¿®æ”¹è®¢å•
self.order_manager.update_order(
    order_id="0xabec2d...",
    new_price=0.420
)
```

**æ—¥å¿—**ï¼š
```
ğŸš€ Worker [0x2e43...] è¿›æ”»(æ’é˜Ÿ): $0.410 -> $0.420
```

#### åœºæ™¯Bï¼šä»·æ ¼ä¸‹è·Œï¼ˆæ”¶å‰²ï¼‰
```
åˆå§‹æŒ‚å•: $0.410
å¸‚åœºå˜åŒ–: æœ€ä½³ä¹°ä»· â†’ $0.400

å†³ç­–:
- å½“å‰æ’å: ç¬¬1ä½ï¼ˆæ’å¤´ï¼‰
- åˆ©æ¶¦æ£€æŸ¥: margin = 0.02 (2%) âœ…
- åŠ¨ä½œ: æ”¶å‰²åˆ° $0.400
```

**æ‰§è¡Œ**ï¼š
```python
self.order_manager.update_order(
    order_id="0xabec2d...",
    new_price=0.400
)
```

**æ—¥å¿—**ï¼š
```
ğŸšœ Worker [0x2e43...] æ”¶å‰²(æ’å¤´): $0.410 -> $0.400
```

### 3.3 åˆ©æ¶¦æ£€æŸ¥ï¼ˆå®šæœŸæ‰§è¡Œï¼‰

#### v6.0 æ¸è¿›å¼åˆ©æ¶¦æ£€æŸ¥
```python
elapsed = time.time() - order_placed_time

# é˜¶æ®µ1: ä¿æŠ¤æœŸï¼ˆ0-5åˆ†é’Ÿï¼‰
if elapsed < 300:
    if profit_margin >= -0.01:  # å®¹å¿1ä¸ªtickäºæŸ
        return True  # ç»§ç»­æŒæœ‰
    else:
        return False  # é€€å‡º

# é˜¶æ®µ2: æ­£å¸¸æœŸï¼ˆ5-10åˆ†é’Ÿï¼‰
if elapsed < 600:
    if profit_margin >= 0.01:  # è¦æ±‚1ä¸ªtickåˆ©æ¶¦
        return True
    else:
        return False  # é€€å‡º

# é˜¶æ®µ3: é•¿æœŸè®¢å•ï¼ˆ10åˆ†é’Ÿ+ï¼‰
if profit_margin >= 0:  # ä¿æœ¬å³å¯
    return True
else:
    return False
```

**ç¤ºä¾‹æ—¶é—´çº¿**ï¼š
```
22:40:54 - [1s]   margin=0.00  âœ… ä¿æŠ¤æœŸï¼Œç»§ç»­
22:41:26 - [32s]  margin=0.00  âœ… ä¿æŠ¤æœŸï¼Œç»§ç»­
22:45:00 - [306s] margin=0.00  âŒ æ­£å¸¸æœŸï¼Œåˆ©æ¶¦ä¸è¶³ï¼Œé€€å‡º
22:50:00 - [600s] margin=0.00  âœ… é•¿æœŸè®¢å•ï¼Œä¿æœ¬å³å¯
```

### 3.4 æ’¤å•é€€å‡º
```python
# åˆ©æ¶¦ä¸è¶³ï¼Œæ’¤å•
self.order_manager.cancel_order(order_id)

# æ³¨é”€ç›‘å¬
self.market_watcher.unregister_observer(task_id)
registry.unregister_order(order_id)

# é‡Šæ”¾æ§½ä½
self.slot_manager.release_slot(market_id)

# è®°å½•å†·å´
self.cooldown_manager.record_exit(market_id, 'PROFIT_PROTECT')
```

**æ—¥å¿—**ï¼š
```
ğŸ“‰ æ­£å¸¸æœŸåˆ©æ¶¦ä¸è¶³: margin=0.0000 < 0.01
ğŸ”• [Observer] æ³¨é”€: maker_7a... â† 2703042814495764...
ğŸ“‹ [Registry] æ³¨é”€è®¢å•: 0xabec2d... (ä»»åŠ¡: maker_7a0427ba)
ğŸ§Š å¸‚åœº [0x2e43...] è¿›å…¥å†·å´: PROFIT_PROTECT -> 60s
â™»ï¸ é‡Šæ”¾æ§½ä½ [0x2e43...] | å‰©ä½™ç©ºé—²: 6
```

---

## é˜¶æ®µ4ï¼šè®¢å•æˆäº¤ä¸å¯¹å†²

### 4.1 UserListener æ¥æ”¶æˆäº¤äº‹ä»¶
```python
# WebSocket æ¶ˆæ¯
{
  "type": "order",
  "event_type": "match",
  "order_id": "0xabec2d...",
  "status": "MATCHED",
  "matched_amount": "5"
}
```

**æ—¥å¿—**ï¼š
```
ğŸ“¨ [UserListener] è®¢å•äº‹ä»¶: 0xabec2d... MATCH MATCHED
```

### 4.2 HedgeDispatcher åˆ†å‘äº‹ä»¶
```python
# hedge_dispatcher.py
def on_order_event(self, order_id, event_type, status):
    # æŸ¥æ‰¾å¯¹åº”çš„ MakerTask
    task = self.registry.find_task_by_order(order_id)
    
    if task and event_type == 'MATCH':
        # å”¤é†’ Worker çº¿ç¨‹
        task.event_queue.put({
            'type': 'FILL',
            'order_id': order_id,
            'status': status
        })
        task.event.set()
```

**æ—¥å¿—**ï¼š
```
ğŸ¯ [Dispatcher] è®¢å•äº‹ä»¶: 0xabec2d... MATCH MATCHED
âœ… [Dispatcher] å·²å”¤é†’ä»»åŠ¡: maker_7a0427ba (MATCH)
```

### 4.3 Worker çº¿ç¨‹å¤„ç†æˆäº¤
```python
# _run_market_worker()
event_data = maker_task.event_queue.get()

if event_data['type'] == 'FILL':
    # æ ‡è®°ä¸ºå·²æˆäº¤
    maker_task.filled = True
    maker_task.status = 'HEDGING'
    
    # åˆ›å»ºå¯¹å†²ä»»åŠ¡
    hedge_task = self.hedger.create_hedge_task(
        market_id=market_id,
        filled_side='NO',
        filled_price=0.410,
        filled_size=5,
        hedge_token_id='5200037681334017...'  # Yes token
    )
```

### 4.4 SmartHedger æ‰§è¡Œå¯¹å†²
```python
# smart_hedger.py
def create_hedge_task(self, ...):
    # 1. è·å–å¯¹æ‰‹ç›˜ä»·æ ¼
    hedge_book = self.client.get_orderbook(hedge_token_id)
    best_ask = 0.590
    
    # 2. è®¡ç®—å¯¹å†²ä»·æ ¼ï¼ˆVWAP + æ»‘ç‚¹ï¼‰
    hedge_price = self._calculate_hedge_price(best_ask)
    # hedge_price = 0.590
    
    # 3. ä¸‹å¯¹å†²å•
    hedge_order_id = self.order_manager.place_order(
        token_id=hedge_token_id,
        side='SELL',
        price=hedge_price,
        size=5
    )
    
    # 4. æ³¨å†Œå¯¹å†²ä»»åŠ¡
    hedge_task = HedgeTask(
        task_id=f"hedge_{uuid.uuid4().hex[:8]}",
        market_id=market_id,
        maker_order_id=maker_order_id,
        hedge_order_id=hedge_order_id,
        ...
    )
    self.registry.register_task(hedge_task)
    self.registry.register_order(hedge_order_id, hedge_task)
```

**æ—¥å¿—**ï¼š
```
ğŸ›¡ï¸ [SmartHedger] åˆ›å»ºå¯¹å†²ä»»åŠ¡: hedge_a3f2b1c4
ğŸ“¤ [å¯¹å†²] ä¸‹å•: YES @ $0.590 Ã— 5 shares
ğŸ“‹ [Registry] æ³¨å†Œå¯¹å†²è®¢å•: 0xdef456... â†’ hedge_a3f2b1c4
```

### 4.5 å¯¹å†²å•æˆäº¤
```python
# UserListener æ¥æ”¶å¯¹å†²å•æˆäº¤
{
  "type": "order",
  "event_type": "match",
  "order_id": "0xdef456...",
  "status": "MATCHED"
}

# HedgeDispatcher åˆ†å‘
hedge_task = self.registry.find_task_by_order("0xdef456...")
hedge_task.status = 'COMPLETED'
```

**æ—¥å¿—**ï¼š
```
ğŸ“¨ [UserListener] è®¢å•äº‹ä»¶: 0xdef456... MATCH MATCHED
âœ… [å¯¹å†²] å¯¹å†²å•æˆäº¤: YES @ $0.590 Ã— 5 shares
```

---

## é˜¶æ®µ5ï¼šè‡ªåŠ¨åˆå¹¶ä¸è·åˆ©

### 5.1 æ£€æµ‹å®Œç¾å¯¹å†²
```python
# balance_tracker.py
def record_fill(self, market_id, side, amount):
    self.positions[market_id][side] += amount
    
    # æ£€æŸ¥æ˜¯å¦å®Œç¾å¯¹å†²
    yes_pos = self.positions[market_id]['yes']
    no_pos = self.positions[market_id]['no']
    
    if abs(yes_pos - no_pos) < 0.1:  # å®Œç¾å¯¹å†²
        return True
```

### 5.2 è§¦å‘è‡ªåŠ¨åˆå¹¶
```python
# auto_merger.py (TSRelayerExecutor)
def merge_positions(self, market_id, amount):
    # 1. è°ƒç”¨ TypeScript Relayer
    result = subprocess.run([
        'node',
        'relayer_executor/dist/merge.js',
        market_id,
        str(amount)
    ])
    
    # 2. ç­‰å¾…é“¾ä¸Šç¡®è®¤
    time.sleep(60)
    
    # 3. éªŒè¯åˆå¹¶ç»“æœ
    positions = self.client.get_positions(user_address)
    # æ£€æŸ¥æŒä»“æ˜¯å¦æ¸…é›¶
```

**æ—¥å¿—**ï¼š
```
ğŸ”„ [AutoMerge] æ£€æµ‹åˆ°å®Œç¾å¯¹å†²: 0x2e43... (5 Yes + 5 No)
âš¡ [Relayer] æ‰§è¡Œå…Gasåˆå¹¶...
âœ… [Relayer] åˆå¹¶æˆåŠŸï¼Œç­‰å¾…ç¡®è®¤...
ğŸ’° [AutoMerge] åˆå¹¶å®Œæˆ: 5 shares â†’ $5.00
```

### 5.3 é‡Šæ”¾æ§½ä½
```python
# åˆå¹¶å®Œæˆåé‡Šæ”¾æ§½ä½
self.slot_manager.release_slot(market_id)

# æ¸…ç† BalanceTracker
self.balance_tracker.clear_market(market_id)
```

**æ—¥å¿—**ï¼š
```
â™»ï¸ é‡Šæ”¾æ§½ä½ [0x2e43...] | å‰©ä½™ç©ºé—²: 6
ğŸ“Š [BalanceTracker] æ¸…ç†å¸‚åœº: 0x2e43...
```

---

## é˜¶æ®µ6ï¼šæœºä¼šæˆæœ¬ä¼˜åŒ–ï¼ˆv6.0 æ–°å¢ï¼‰

### 6.1 æ§½ä½æ»¡æ—¶çš„æ£€æŸ¥
```python
# main_execution.py - run()
if slot_status['is_full']:
    # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æœºä¼šæˆæœ¬
    if current_time - last_opportunity_check_time > 30:
        self._check_opportunity_cost_replacement()
```

### 6.2 æŸ¥æ‰¾æœ€å·®è®¢å•
```python
# _find_worst_active_slot()
protected_orders = registry.get_all_active_order_ids()  # å¯¹å†²è®¢å•

worst = None
worst_margin = float('inf')

for market_id in active_slots:
    for order in open_orders:
        # è·³è¿‡å¯¹å†²è®¢å•
        if order_id in protected_orders:
            continue
        
        # è®¡ç®—åˆ©æ¶¦
        margin = 1.0 - (my_price + hedge_price)
        
        if margin < worst_margin:
            worst = {
                'market_id': market_id,
                'current_margin': margin,
                'order_id': order_id
            }
```

### 6.3 å†³ç­–æ›¿æ¢
```python
# _check_opportunity_cost_replacement()
best_new_market, best_new_score = self.opportunity_pool.peek_best_market()
worst_slot = self._find_worst_active_slot()

# å†³ç­–é€»è¾‘
if worst_margin < 0:
    should_replace = True  # äºæŸè®¢å•ï¼Œç«‹å³æ›¿æ¢
elif worst_margin == 0 and best_new_score > 0:
    should_replace = True  # 0åˆ©æ¶¦ vs é«˜åˆ†æœºä¼š
elif worst_margin > 0 and best_new_score > 50:
    should_replace = True  # ä½åˆ©æ¶¦ vs è¶…é«˜åˆ†æœºä¼š
```

### 6.4 æ‰§è¡Œæ›¿æ¢
```python
# _replace_slot()
# 1. æ’¤é”€æ—§çš„Makerè®¢å•ï¼ˆä¿æŠ¤å¯¹å†²è®¢å•ï¼‰
for order in open_orders:
    if order_id not in protected_orders:
        self.order_manager.cancel_order(order_id)

# 2. é‡Šæ”¾æ§½ä½
self.slot_manager.release_slot(old_market_id)

# 3. è®°å½•å†·å´
self.cooldown_manager.record_exit(old_market_id, 'REPLACED')

# 4. æäº¤æ–°ä»»åŠ¡
market, score = self.opportunity_pool.pop_best_market()
self.worker_pool.submit(self._process_market_safe, market)
```

**æ—¥å¿—**ï¼š
```
ğŸ”„ [æœºä¼šæˆæœ¬] å‘ç°æ›¿æ¢æœºä¼š: 0åˆ©æ¶¦è®¢å• vs é«˜åˆ†æœºä¼š (score=45)
   æ—§: 0x2e43d8... (margin=0.00%)
   æ–°: Will Trump win 2028?... (score=45)
ğŸš« [æ›¿æ¢] æ’¤é”€Makerè®¢å•: 0xabec2d...
ğŸ›¡ï¸ [æ›¿æ¢] ä¿æŠ¤å¯¹å†²è®¢å•ï¼Œä¸æ’¤é”€: 0xdef456...
â™»ï¸ é‡Šæ”¾æ§½ä½ [0x2e43...] | å‰©ä½™ç©ºé—²: 1
âœ… [æ›¿æ¢] æäº¤æ–°ä»»åŠ¡: Will Trump win 2028?...
```

---

## å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ0: ç³»ç»Ÿå¯åŠ¨                                              â”‚
â”‚ - å‡¤å‡°åè®®ï¼ˆæ¸…ç†+åˆå¹¶+æ¥ç®¡ï¼‰                                 â”‚
â”‚ - æ§½ä½ç³»ç»Ÿåˆå§‹åŒ–                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ1: å¸‚åœºæ‰«æï¼ˆScanner Threadï¼Œæ¯10ç§’ï¼‰                   â”‚
â”‚ - è·å–300ä¸ªå¸‚åœº                                              â”‚
â”‚ - Strategy Selector è´¨æ£€                                     â”‚
â”‚ - æ›´æ–°æœºä¼šæ±                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ2: æŒ‚å•ï¼ˆMain Loopï¼‰                                     â”‚
â”‚ - ä»æœºä¼šæ± å–æœ€ä½³å¸‚åœº                                         â”‚
â”‚ - åšå¸‚åˆ†æ                                                   â”‚
â”‚ - ç”³è¯·æ§½ä½                                                   â”‚
â”‚ - ä¸‹å•                                                       â”‚
â”‚ - æ³¨å†Œç›‘å¬ï¼ˆMarketWatcher + Registryï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ3: è®¢å•ç›‘æ§ï¼ˆWorker Threadï¼‰                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç­‰å¾…å”¤é†’ä¿¡å·ï¼š                                           â”‚ â”‚
â”‚ â”‚ A. MarketWatcher ä»·æ ¼å˜åŒ– â†’ è¿½å•/æ”¶å‰²                   â”‚ â”‚
â”‚ â”‚ B. UserListener è®¢å•äº‹ä»¶ â†’ æˆäº¤å¤„ç†                     â”‚ â”‚
â”‚ â”‚ C. GlobalOrderSyncer å®¡è®¡ â†’ çŠ¶æ€åŒæ­¥                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ å®šæœŸåˆ©æ¶¦æ£€æŸ¥ï¼ˆv6.0ï¼‰ï¼š                                        â”‚
â”‚ - 0-5åˆ†é’Ÿ: ä¿æŠ¤æœŸï¼ˆå®¹å¿-1%ï¼‰                                 â”‚
â”‚ - 5-10åˆ†é’Ÿ: æ­£å¸¸æœŸï¼ˆè¦æ±‚1%ï¼‰                                 â”‚
â”‚ - 10åˆ†é’Ÿ+: é•¿æœŸè®¢å•ï¼ˆä¿æœ¬å³å¯ï¼‰                              â”‚
â”‚                                                               â”‚
â”‚ åˆ©æ¶¦ä¸è¶³ â†’ æ’¤å•é€€å‡º â†’ é‡Šæ”¾æ§½ä½ â†’ è®°å½•å†·å´                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ4: è®¢å•æˆäº¤ä¸å¯¹å†²                                        â”‚
â”‚ 1. UserListener æ¥æ”¶æˆäº¤äº‹ä»¶                                 â”‚
â”‚ 2. HedgeDispatcher åˆ†å‘äº‹ä»¶                                  â”‚
â”‚ 3. Worker çº¿ç¨‹å¤„ç†æˆäº¤                                       â”‚
â”‚ 4. SmartHedger æ‰§è¡Œå¯¹å†²                                      â”‚
â”‚    - è·å–å¯¹æ‰‹ç›˜ä»·æ ¼                                          â”‚
â”‚    - è®¡ç®—å¯¹å†²ä»·æ ¼ï¼ˆVWAP + æ»‘ç‚¹ï¼‰                             â”‚
â”‚    - ä¸‹å¯¹å†²å•                                                â”‚
â”‚    - æ³¨å†Œå¯¹å†²ä»»åŠ¡ï¼ˆå—ä¿æŠ¤ï¼‰                                  â”‚
â”‚ 5. å¯¹å†²å•æˆäº¤                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ5: è‡ªåŠ¨åˆå¹¶ä¸è·åˆ©                                        â”‚
â”‚ 1. BalanceTracker æ£€æµ‹å®Œç¾å¯¹å†²                               â”‚
â”‚ 2. TSRelayerExecutor æ‰§è¡Œå…Gasåˆå¹¶                           â”‚
â”‚ 3. ç­‰å¾…é“¾ä¸Šç¡®è®¤ï¼ˆ60ç§’ï¼‰                                      â”‚
â”‚ 4. éªŒè¯åˆå¹¶ç»“æœ                                              â”‚
â”‚ 5. é‡Šæ”¾æ§½ä½                                                  â”‚
â”‚ 6. æ¸…ç† BalanceTracker                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ6: æœºä¼šæˆæœ¬ä¼˜åŒ–ï¼ˆv6.0ï¼Œæ¯30ç§’ï¼‰                          â”‚
â”‚ æ§½ä½æ»¡æ—¶ï¼š                                                   â”‚
â”‚ 1. Peek æœºä¼šæ± æœ€ä½³æœºä¼š                                       â”‚
â”‚ 2. æŸ¥æ‰¾æœ€å·®Makerè®¢å•ï¼ˆè·³è¿‡å¯¹å†²è®¢å•ï¼‰                         â”‚
â”‚ 3. å†³ç­–æ˜¯å¦æ›¿æ¢ï¼š                                            â”‚
â”‚    - äºæŸè®¢å• â†’ ç«‹å³æ›¿æ¢                                     â”‚
â”‚    - 0åˆ©æ¶¦è®¢å• + é«˜åˆ†æœºä¼š â†’ æ›¿æ¢                             â”‚
â”‚    - ä½åˆ©æ¶¦è®¢å• + è¶…é«˜åˆ†æœºä¼š â†’ æ›¿æ¢                          â”‚
â”‚ 4. æ‰§è¡Œæ›¿æ¢ï¼š                                                â”‚
â”‚    - æ’¤é”€Makerè®¢å•ï¼ˆä¿æŠ¤å¯¹å†²è®¢å•ï¼‰                           â”‚
â”‚    - é‡Šæ”¾æ§½ä½                                                â”‚
â”‚    - æäº¤æ–°ä»»åŠ¡                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
                    å›åˆ°é˜¶æ®µ2ï¼ˆå¾ªç¯ï¼‰
```

---

## å…³é”®ç»„ä»¶äº¤äº’å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Main Loop    â”‚ â† ä¸»å¾ªç¯ï¼Œæ¶ˆè´¹æœºä¼šæ± 
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ OpportunityPool â† Scanner Thread æ›´æ–°
       â”‚
       â”œâ”€â†’ SlotManager â† ç®¡ç†èµ„é‡‘æ§½ä½
       â”‚
       â”œâ”€â†’ Worker Pool â† æäº¤å¸‚åœºå¤„ç†ä»»åŠ¡
       â”‚
       â””â”€â†’ CooldownManager â† ç®¡ç†å¸‚åœºå†·å´

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Worker       â”‚ â† å¤„ç†å•ä¸ªå¸‚åœºçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ MarketMakerAnalyzer â† åšå¸‚åˆ†æ
       â”‚
       â”œâ”€â†’ OrderManager â† ä¸‹å•/æ”¹å•/æ’¤å•
       â”‚
       â”œâ”€â†’ MarketWatcher â† æ³¨å†Œä»·æ ¼ç›‘å¬
       â”‚
       â”œâ”€â†’ HedgeTaskRegistry â† æ³¨å†Œè®¢å•äº‹ä»¶
       â”‚
       â””â”€â†’ SmartHedger â† æˆäº¤ååˆ›å»ºå¯¹å†²ä»»åŠ¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MarketWatcherâ”‚ â† WebSocket ä»·æ ¼æµ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â†’ Observer Pattern â† é€šçŸ¥ Worker ä»·æ ¼å˜åŒ–

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UserListener â”‚ â† WebSocket è®¢å•äº‹ä»¶æµ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â†’ HedgeDispatcher â† åˆ†å‘è®¢å•äº‹ä»¶

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚HedgeDispatcherâ”‚ â† äº‹ä»¶åˆ†å‘ä¸­å¿ƒ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ HedgeTaskRegistry â† æŸ¥æ‰¾ä»»åŠ¡
       â”‚
       â””â”€â†’ Worker/SmartHedger â† å”¤é†’ä»»åŠ¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SmartHedger  â”‚ â† å¯¹å†²å¼•æ“
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ OrderManager â† ä¸‹å¯¹å†²å•
       â”‚
       â”œâ”€â†’ HedgeTaskRegistry â† æ³¨å†Œå¯¹å†²ä»»åŠ¡
       â”‚
       â””â”€â†’ BalanceTracker â† è®°å½•æŒä»“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚BalanceTrackerâ”‚ â† æŒä»“å¿«ç…§è¿½è¸ª
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â†’ AutoMerger â† æ£€æµ‹å®Œç¾å¯¹å†²ï¼Œè§¦å‘åˆå¹¶

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AutoMerger   â”‚ â† è‡ªåŠ¨åˆå¹¶ï¼ˆå…Gasï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â†’ TSRelayerExecutor â† è°ƒç”¨ TypeScript Relayer
```

---

## æ€»ç»“

### æ ¸å¿ƒç‰¹æ€§
1. âœ… **äº‹ä»¶é©±åŠ¨æ¶æ„**ï¼šMarketWatcher + UserListener å®æ—¶å“åº”
2. âœ… **æ¸è¿›å¼åˆ©æ¶¦æ£€æŸ¥**ï¼šä¿æŠ¤æœŸ â†’ æ­£å¸¸æœŸ â†’ é•¿æœŸè®¢å•
3. âœ… **æ™ºèƒ½å¯¹å†²**ï¼šæˆäº¤åè‡ªåŠ¨å¯¹å†²ï¼Œé”å®šåˆ©æ¶¦
4. âœ… **è‡ªåŠ¨åˆå¹¶**ï¼šå…Gasåˆå¹¶ï¼Œé‡Šæ”¾èµ„é‡‘
5. âœ… **æœºä¼šæˆæœ¬ä¼˜åŒ–**ï¼šä¸»åŠ¨æ›¿æ¢ä½æ•ˆè®¢å•
6. âœ… **å¯¹å†²è®¢å•ä¿æŠ¤**ï¼šæ›¿æ¢æ—¶ä¸ç¢°å¯¹å†²è®¢å•

### å®‰å…¨ä¿éšœ
1. âœ… **æ§½ä½ç³»ç»Ÿ**ï¼šé˜²æ­¢è¿‡åº¦æ æ†
2. âœ… **å†·å´æœºåˆ¶**ï¼šé¿å…é¢‘ç¹è¿›å‡ºåŒä¸€å¸‚åœº
3. âœ… **å½±å­åº“å­˜**ï¼šé˜²æ­¢é‡å¤ä¸‹å•
4. âœ… **å¯¹å†²ä¿æŠ¤**ï¼šä¸æ’¤é”€å¯¹å†²è®¢å•
5. âœ… **ä½™é¢çœ‹é—¨ç‹—**ï¼šç›‘æ§å¼‚å¸¸èµ„é‡‘å˜åŠ¨
6. âœ… **å‡¤å‡°åè®®**ï¼šå¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤

### æ€§èƒ½ä¼˜åŒ–
1. âœ… **æ‰¹é‡ä»·æ ¼æŸ¥è¯¢**ï¼šå‡å°‘APIè°ƒç”¨
2. âœ… **å…ƒæ•°æ®ç¼“å­˜**ï¼šæœ¬åœ°æŒä¹…åŒ–
3. âœ… **çº¿ç¨‹æ± **ï¼šå¹¶å‘å¤„ç†å¤šä¸ªå¸‚åœº
4. âœ… **WebSocket**ï¼šå®æ—¶æ•°æ®æµ
5. âœ… **å®šæœŸå¯¹è´¦**ï¼š10åˆ†é’Ÿä¸€æ¬¡ï¼ˆv6.0ä¼˜åŒ–ï¼‰

