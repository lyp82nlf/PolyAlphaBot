# 核心交易逻辑全解 (v9.5)

本文档详细拆解了机器人目前的**下单判定**、**价格计算**、**追单博弈**以及**撤单退出**逻辑。

... (前文保持不变)

## 3. 退出与撤单逻辑 (Exit Logic Decision Tree) - **v9.5 重构**

**位置**: `main_execution.py` -> `_run_market_worker` (P2 区域)

机器人采用 **5级优先级** 决策树来管理退出逻辑：

### 🔴 优先级 1: 利润保护 (PROFIT_PROTECT)
- **触发**: `Expected ROE < 2% (FORCE_MIN_ROE)`。
- **动作**: 立即撤单。
- **价值**: 拒绝无效交易，保本第一。
- **注意**: 即使是因盘口瞬间闪烁导致的利润下降，只要触碰红线也会坚决撤单，不留任何风险敞口。

### 🧱 优先级 2: 掩体塌陷 (BUNKER_COLLAPSE)
- **触发**: 身后累计深度 `Volume Behind < $30`。
- **动作**: 撤单撤退。
- **价值**: 失去支撑意味着裸奔，风险极大。

### 🏗️ 优先级 3: 阻力过载 (RESISTANCE_OVERLOAD)
- **触发**: 前方阻力 `Volume Ahead > $50` 且根据 P1 逻辑**无法追单**。
- **动作**: 撤单释放槽位。

...(后续保持不变)
